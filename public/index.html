<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <!--
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="manifest" href="manifest.json"> -->
    
    <link rel="stylesheet" href="styles.css">

    <title>Student</title>
</head>

<body>

    <div id="header-container"></div>  
    

 
    <div class = "container">
    <!--Меню-->
    <nav class="sidebar">
    <ul>
        <a href="/" class="nav-link">Dashboard</a>
        <a href="/students.html" class="nav-link">Students</a>
        <a href="/tasks.html" class="nav-link">Tasks</a>
    </ul>
</nav>


    <h1>Dashboard</h1>
    <p>info</p>
<!--ff-->

<div id="loginModal" class="modal">
    <div class="modal-content">      
      <h2>Login</h2>
      <form id="loginForm">
        <label for="username">Login:</label>
        <input type="text" id="username" name="username" required>
        <label for="password">Password:</label>
        <input type="text" id="password" name="password" placeholder="YYYY-MM-DD" required>
        <button type="submit">Log in</button>
      </form>
      <div id="loginError" style="color:red; display:none;">Incorrect data.</div>
    </div>
  </div>

   

  <script>
fetch('header.html')
    .then(response => response.text())
    .then(data => {
        document.getElementById('header-container').innerHTML = data;

        // Завантажуємо інформацію про користувача після завантаження хедера
        loadUserInfo();

        // Налаштовуємо обробник для кнопки логауту
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
            logoutBtn.addEventListener("click", async function () {
                try {
                    const response = await fetch("/logout");
                    const data = await response.json();

                    if (data.success) {
                        window.location.href = "/login.php";
                    }
                } catch (error) {
                    console.error("Logout failed:", error);
                    // Fallback - перенаправляємо на логін навіть при помилці
                    window.location.href = "/login.php";
                }
            });
        }
    })
    .catch(error => console.error('Error loading header.html:', error));

// Функція для завантаження інформації про користувача
async function loadUserInfo() {
    try {
        const response = await fetch('/getuser.php');
        const data = await response.json();
        
        const usernameDisplay = document.getElementById('username-display');
        
        if (data.success && data.user) {
            // Відображаємо ім'я та прізвище користувача
            const fullName = `${data.user.name} ${data.user.surname}`;
            usernameDisplay.textContent = fullName;
            
            // Зберігаємо дані користувача для використання в чаті та інших місцях
            window.currentUser = data.user;
            
            // Оновлюємо змінну currentUser в messages.html якщо вона існує
            if (typeof currentUser !== 'undefined') {
                currentUser = data.user.name;
            }
        } else {
            usernameDisplay.textContent = 'Guest';
            console.log('User not logged in, redirecting to login page...');
            // Можна розкоментувати для автоматичного перенаправлення
            // window.location.href = '/login.php';
        }
    } catch (error) {
        console.error('Error loading user info:', error);
        const usernameDisplay = document.getElementById('username-display');
        if (usernameDisplay) {
            usernameDisplay.textContent = 'Guest';
        }
    }
}
</script>

<script src="/scripts.js"></script>

</body>
</html>